<?xml version="1.0" encoding="UTF-8"?><xsl:stylesheet version="1.0"	xmlns="http://www.w3.org/1999/xhtml"	xmlns:xsl="http://www.w3.org/1999/XSL/Transform">		<xsl:import href="/getTemplate.php/mtg/global"/>		<xsl:template match="/data">		<html>			<xsl:call-template name="sites.head"/>			<body>				<main class="bill">					<h1>Slothsoft's Magic: The Gathering Bill</h1>					<xsl:apply-templates select="*/resource"/>				</main>			</body>		</html>	</xsl:template>		<xsl:template match="resource">		<xsl:variable name="resource" select="."/>		<table >			<thead>				<tr>					<th>Date</th>					<th>Type</th>					<th>Shop</th>					<th>Amount</th>				</tr>			</thead>			<tfoot>				<tr class="expense">					<th/>					<th/>					<th>Total</th>					<th class="number euro"><xsl:value-of select="format-number(sum(line/@cost), '0.00')"/></th>				</tr>			</tfoot>			<tbody>				<xsl:for-each select="line">					<tr>						<td class="number"><xsl:value-of select="@date"/></td>						<td><xsl:value-of select="@type"/></td>						<td><xsl:value-of select="@shop"/></td>						<td class="number euro"><xsl:value-of select="@cost"/></td>					</tr>				</xsl:for-each>			</tbody>			<tbody>				<xsl:variable name="shopList" select="line/@shop[not(. = following::line/@shop)]"/>				<xsl:for-each select="$shopList">					<xsl:sort select="."/>					<xsl:sort select="sum($resource/line[@shop = current()]/@cost)" data-type="number"/>					<xsl:variable name="sum" select="sum($resource/line[@shop = current()]/@cost)"/>					<tr>						<th/>						<th/>						<th><xsl:value-of select="."/></th>						<th class="number euro"><xsl:value-of select="format-number($sum, '0.00')"/></th>					</tr>				</xsl:for-each>			</tbody>			<tbody>				<xsl:variable name="typeList" select="line/@type[not(. = following::line/@type)]"/>				<xsl:for-each select="$typeList">					<xsl:sort select="."/>					<xsl:sort select="sum($resource/line[@type = current()]/@cost)" data-type="number"/>					<xsl:variable name="sum" select="sum($resource/line[@type = current()]/@cost)"/>					<tr>						<th/>						<th><xsl:value-of select="."/></th>						<th/>						<th class="number euro"><xsl:value-of select="format-number($sum, '0.00')"/></th>					</tr>				</xsl:for-each>			</tbody>			<tbody>				<xsl:variable name="yearList" select="line/@year[not(. = following::line/@year)]"/>				<xsl:for-each select="$yearList">					<xsl:sort select="."/>					<xsl:sort select="sum($resource/line[@year = current()]/@cost)" data-type="number"/>					<tr class="expense">						<xsl:variable name="sum" select="sum($resource/line[@year = current()]/@cost[. &gt; 0])"/>						<th><xsl:value-of select="."/></th>						<th/>						<th/>						<th class="number euro"><xsl:value-of select="format-number($sum, '0.00')"/></th>					</tr>					<tr class="revenue">						<xsl:variable name="sum" select="sum($resource/line[@year = current()]/@cost[. &lt; 0])"/>						<th><xsl:value-of select="."/></th>						<th/>						<th/>						<th class="number euro"><xsl:value-of select="format-number($sum, '0.00')"/></th>					</tr>				</xsl:for-each>			</tbody>		</table>	</xsl:template></xsl:stylesheet>
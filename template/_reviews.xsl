<?xml version="1.0" encoding="UTF-8"?><xsl:stylesheet version="1.0"	xmlns="http://www.w3.org/1999/xhtml"	xmlns:xsl="http://www.w3.org/1999/XSL/Transform"	xmlns:mtg="http://slothsoft.net/MTG/">		<xsl:import href="/getTemplate.php/mtg/global"/>	<xsl:template match="/data">		<html>			<xsl:call-template name="sites.head"/>			<body>				<main>					<h1>Magic Reviews</h1>										<form action="" method="POST">						<xsl:apply-templates select="data/oracle/categories/set">							<xsl:with-param name="review" select="data/review"/>						</xsl:apply-templates>						<input type="submit"/>					</form>				</main>			</body>		</html>	</xsl:template>		<xsl:template match="set">		<xsl:param name="review" select="/.."/>		<xsl:variable name="set" select="."/>		<xsl:variable name="cardList" select="$review/set[@name = current()]/card"/>		<xsl:variable name="expansion-key" select="$set"/>		<xsl:if test="count($cardList)">			<xsl:variable name="search-internal">				<xsl:call-template name="search.internal">					<xsl:with-param name="expansion" select="$expansion-key"/>				</xsl:call-template>			</xsl:variable>			<xsl:variable name="search-external">				<xsl:call-template name="search.external">					<xsl:with-param name="expansion" select="$expansion-key"/>				</xsl:call-template>			</xsl:variable>			<!--<xsl:variable name="searchDocument" select="document($search-internal)"/>-->			<xsl:variable name="searchDocument" select="mtg:cards-by-expansion($expansion-key)"/>			<details>				<summary><h2><xsl:value-of select="."/></h2></summary>				<div class="cardList">					<xsl:for-each select="$searchDocument//search/card">						<xsl:sort select="@sort"/>						<div class="review-card">							<div>								<xsl:call-template name="card">									<xsl:with-param name="card" select="."/>									<xsl:with-param name="mode" select="'view'"/>								</xsl:call-template>							</div>							<div>								<h3><xsl:value-of select="@name"/></h3>								<xsl:for-each select="$cardList[@name = current()/@name]">									<xsl:choose>										<xsl:when test="$review/@mode = 'edit'">											<h4>												<xsl:value-of select="../../@name"/>:												<input name="review[{../../@name}][{$set}][{@name}][rating]" type="number" min="0" max="10" value="{@rating}"/>											</h4>											<textarea name="review[{../../@name}][{$set}][{@name}][comment]"><xsl:value-of select="@comment"/></textarea>										</xsl:when>										<xsl:otherwise>											<details>												<summary><xsl:value-of select="concat(../../@name, ': ', @rating)"/></summary>												<div>													<p><xsl:value-of select="@comment"/></p>												</div>											</details>										</xsl:otherwise>									</xsl:choose>								</xsl:for-each>							</div>						</div>					</xsl:for-each>					<!--					<xsl:call-template name="cardList">						<xsl:with-param name="cardList" select="$searchDocument//search/card"/>						<xsl:with-param name="mode" select="'view'"/>						<xsl:with-param name="open" select="false()"/>					</xsl:call-template>					-->				</div>			</details>		</xsl:if>	</xsl:template></xsl:stylesheet>